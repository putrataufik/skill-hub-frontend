<div class="participants-page container-fluid">
  <div class="row g-3">
    <div class="col-12 col-lg-4">
      <div class="card shadow-sm participants-card">
        <div
          class="card-header d-flex justify-content-between align-items-center participants-header"
        >
          <h5 class="mb-0">Participants</h5>
          <button
            type="button"
            class="btn btn-sm btn-primary"
            (click)="openAddModal()"
          >
            Add Participant
          </button>
        </div>

        <div class="card-body p-0">
          <div *ngIf="isLoadingList" class="text-muted small p-2">
            Loading participants...
          </div>

          <ng-container *ngIf="!isLoadingList">
            <div
              class="table-responsive"
              *ngIf="participants.length > 0; else noParticipants"
            >
              <table
                class="table table-sm table-hover mb-0 participants-table"
              >
                <thead class="table-light">
                  <tr>
                    <th scope="col">Full Name</th>
                    <th scope="col">Email</th>
                    <th scope="col">Phone</th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    *ngFor="let p of participants"
                    (click)="onSelectParticipant(p)"
                    [class.active]="selectedParticipant?.id === p.id"
                  >
                    <td class="fw-semibold">{{ p.fullName }}</td>
                    <td class="text-muted small">{{ p.email }}</td>
                    <td class="text-muted small">{{ p.phone }}</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <ng-template #noParticipants>
              <div class="text-muted small p-2">
                No participants found. Click "Add Participant" to create one.
              </div>
            </ng-template>
          </ng-container>
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-8">
      <div *ngIf="isLoadingDetail" class="text-muted small mb-2">
        Loading participant detail...
      </div>

      <ng-container *ngIf="selectedParticipant; else noSelection">
        <div class="card shadow-sm participant-detail-card">
          <div class="card-header d-flex justify-content-between">
            <div>
              <h5 class="mb-0">
                {{ selectedParticipant.fullName }}
              </h5>
              <div class="small text-muted">
                ID: {{ selectedParticipant.id }}
              </div>
            </div>
            <div class="text-end">
              <div class="small text-muted">
                Created:
                {{
                  selectedParticipant.createdAt
                    | date : 'dd MMM yyyy, HH:mm'
                }}
              </div>
              <div class="small text-muted">
                Updated:
                {{
                  selectedParticipant.updatedAt
                    | date : 'dd MMM yyyy, HH:mm'
                }}
              </div>

              <button
                type="button"
                class="btn btn-sm btn-outline-danger mt-2"
                (click)="onDeleteParticipant()"
              >
                Delete
              </button>
            </div>
          </div>

          <div class="card-body">
            <div class="row mb-3">
              <div class="col-12 col-md-6">
                <div class="detail-item">
                  <div class="detail-label">Email</div>
                  <div class="detail-value">
                    {{ selectedParticipant.email || '-' }}
                  </div>
                </div>
                <div class="detail-item">
                  <div class="detail-label">Phone</div>
                  <div class="detail-value">
                    {{ selectedParticipant.phone || '-' }}
                  </div>
                </div>
              </div>

              <div class="col-12 col-md-6">
                <div class="detail-item">
                  <div class="detail-label">Date of Birth</div>
                  <div class="detail-value">
                    {{
                      selectedParticipant.dateOfBirth
                        | date : 'dd MMM yyyy'
                    }}
                  </div>
                </div>
              </div>
            </div>

      
            <h6 class="mb-2">Enrollments</h6>

            <div class="table-responsive">
              <table
                class="table table-sm table-hover align-middle enrollments-table mb-0"
              >
                <thead class="table-light">
                  <tr>
                    <th>Class</th>
                    <th>Instructor</th>
                    <th>Period</th>
                    <th>Status</th>
                    <th>Notes</th>
                    <th>Enrolled At</th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    *ngFor="
                      let e of selectedParticipant.enrollments || []
                    "
                  >
                    <td>{{ e.class.className }}</td>
                    <td class="text-muted small">
                      {{ e.class.instructor }}
                    </td>
                    <td class="text-muted small">
                      {{
                        e.class.startDate
                          | date : 'dd MMM yyyy'
                      }}
                      -
                      {{
                        e.class.endDate
                          | date : 'dd MMM yyyy'
                      }}
                    </td>
                    <td>
                      <span
                        class="badge"
                        [ngClass]="{
                          'bg-success': e.isActive,
                          'bg-secondary': !e.isActive
                        }"
                      >
                        {{ e.isActive ? 'YES' : 'NO' }}
                      </span>
                    </td>
                    <td class="text-muted small">
                      {{ e.notes || '-' }}
                    </td>
                    <td class="text-muted small">
                      {{
                        e.enrollmentDate
                          | date : 'dd MMM yyyy, HH:mm'
                      }}
                    </td>
                  </tr>

                  <tr *ngIf="!selectedParticipant.enrollments.length">
                    <td colspan="7" class="text-center text-muted small py-3">
                      No enrollments for this participant.
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-template #noSelection>
        <div class="card shadow-sm">
          <div class="card-body text-muted small">
            Select a participant from the list to view details.
          </div>
        </div>
      </ng-template>
    </div>
  </div>

  
  <div class="sh-modal-backdrop" *ngIf="showAddModal">
    <div class="sh-modal">
      <div class="sh-modal-header">
        <h5 class="mb-0">Add Participant</h5>
        <button
          type="button"
          class="btn-close"
          aria-label="Close"
          (click)="closeAddModal()"
        ></button>
      </div>

      <div class="sh-modal-body">
        <form [formGroup]="addForm" (ngSubmit)="submitAddParticipant()">
          <div class="mb-3">
            <label class="form-label">Full Name</label>
            <input
              type="text"
              class="form-control form-control-sm"
              formControlName="fullName"
            />
            <div
              class="text-danger small mt-1"
              *ngIf="fullNameCtrl?.invalid && fullNameCtrl?.touched"
            >
              Full name is required (min 3 characters).
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Email</label>
            <input
              type="email"
              class="form-control form-control-sm"
              formControlName="email"
            />
            <div
              class="text-danger small mt-1"
              *ngIf="emailCtrl?.invalid && emailCtrl?.touched"
            >
              Valid email is required.
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Phone</label>
            <input
              type="text"
              class="form-control form-control-sm"
              formControlName="phone"
            />
            <div
              class="text-danger small mt-1"
              *ngIf="phoneCtrl?.invalid && phoneCtrl?.touched"
            >
              Phone is required.
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Date of Birth</label>
            <input
              type="date"
              class="form-control form-control-sm"
              formControlName="dateOfBirth"
            />
            <div
              class="text-danger small mt-1"
              *ngIf="dobCtrl?.invalid && dobCtrl?.touched"
            >
              Date of birth is required.
            </div>
          </div>

          <div class="d-flex justify-content-end gap-2 mt-3">
            <button
              type="button"
              class="btn btn-sm btn-outline-secondary"
              (click)="closeAddModal()"
              [disabled]="isSubmitting"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="btn btn-sm btn-primary"
              [disabled]="isSubmitting"
            >
              <span
                *ngIf="isSubmitting"
                class="spinner-border spinner-border-sm me-1"
              ></span>
              Save
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
